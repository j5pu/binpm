#!/bin/sh

#
# show description, help, repository, version or subsections (SYNOPSYS, etc.) from man page
set -eu

#######################################
# show description withouth from manpage
# Arguments:
#  None
#######################################
desc() { name | sed "s/^${cmd} - //" | tr '\n' ' ' | xargs; }

#######################################
# show description from manpage
# Arguments:
#  None
#######################################
description() { subsection 'DESCRIPTION'; }

#######################################
# show plain from manpage
# Arguments:
#  None
#######################################
help() { cat; }

#######################################
# show repository from manpage
# Arguments:
#  None
#######################################
manrepo() { awk '/^REPOSITORY$/{ getline; print $1 }'; }

#######################################
# show name from manpage
# Arguments:
#  None
#######################################
name() { subsection NAME; }

#######################################
# show subsection from manpage
# Arguments:
#   1   Subsection name
#######################################
subsection() { sed -n -e "/^${1}/,/^[A-Z]/ p" | grep -v -e "^[A-Z]" | xargs; }

#######################################
# show subsections from manpage
# Arguments:
#  None
#######################################
subsections() { awk '/^[A-Z ]+$/ {print}'; }

#######################################
# show synopsis from manpage
# Arguments:
#  None
#######################################
synopsis() { subsection 'SYNOPSIS'; }

#######################################
# show version from manpage
# Arguments:
#  None
#######################################
version() { tail -1 | awk '{ print $2 }'; }

#######################################
# show description, help, repository, version or subsections (SYNOPSYS, etc.) from man page
# Globals:
#   COMMAND   The command to show information.
# Arguments:
#   1   [--description|--name|--subsections|--synopsis|--desc|--help|--manrepo|--version|...]
#######################################
main() {
  # col -bx because man adds something (col -b) works.
  cmd="${COMMAND:-${0##*/}}"
  [ ! "${1-}" ] || rv="$(man "${cmd}" 2>/dev/null | col -b | "${1#--}")"
  [ "${rv-}" ] || exit 1
  echo "${rv}"
}

main "$@"
